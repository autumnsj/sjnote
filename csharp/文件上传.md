dd\
public JsonResult UploadFile( string type)\
{\
HttpPostedFileBase file;\
file = Request.Files\[0\];\
switch (type)\
{\
case \"CreateOrEditCustomer\":\
{\
List\<string\> imageType = new List\<string\>();\
System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string maxImgName;\
string minImgName;\
System.Drawing.Image minImg;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
if (!imageType.Contains(file.ContentType))\
{\
return Json(new { status = false, message =
\"只能上传:png,jpeg格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/customer/logo/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
maxImgName = guid.ToString() + \"\_max.jpg\";\
minImgName = guid.ToString() + \"\_min.jpg\";\
minImg = \_imagesHelper.MakeThumbnail(img, 500, 500);\
img.Save(mapPath + maxImgName, ImageFormat.Jpeg);\
minImg.Save(mapPath + minImgName, ImageFormat.Jpeg);\
img.Dispose();\
minImg.Dispose();

return Json(new { status = true, maxUrl = imgDir + maxImgName, minUrl =
imgDir +\
minImgName });\
}\
case \"AddCustomerNotepad\":\
{\
List\<string\> imageType = new List\<string\>();\
System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string maxImgName;\
string minImgName;\
System.Drawing.Image minImg;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
imageType.Add(\"image/gif\");\
imageType.Add(\"image/bmp\");\
if (!imageType.Contains(file.ContentType))\
{\
return Json(new { status = false, message =
\"只能上传:png,jpeg,gif,bmp格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/customer/notepad/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
maxImgName = guid.ToString() + \"\_max.jpg\";\
minImgName = guid.ToString() + \"\_min.jpg\";\
int sourWidth = img.Width;\
int sourHeight = img.Height;\
int width = 0, height = 0;\
if (sourWidth \> 100)\
{\
width = 100;\
height = (100 \* sourHeight) / sourWidth;

}\
else\
{\
width = sourWidth;\
height = sourHeight;\
}\
minImg = \_imagesHelper.MakeThumbnail(img, width, height);\
img.Save(mapPath + maxImgName, ImageFormat.Jpeg);\
minImg.Save(mapPath + minImgName, ImageFormat.Jpeg);\
img.Dispose();\
minImg.Dispose();\
return Json(new { status = true, maxUrl = imgDir + maxImgName, minUrl =
imgDir +\
minImgName });\
}\
case \"UploadDoc\":\
{\
var dd = file.FileName.Split(\'.\');\
string stype = \"txt,docx,pdf,xlsx,html,ppt,pptx,png,jpg,gif,bmp\";\
string fileExName = dd\[dd.Length - 1\];\
if (!stype.Contains(fileExName.ToLower()))\
{\
return Json(new { status = false, message = \"只能上传\" + stype +
\"类型文件\" });\
}\
string fileDir = ConfigurationManager.AppSettings\[\"UploadDoc\"\]+
AbpSession.UserName +\
\"/\";\
Directory.CreateDirectory(Server.MapPath(fileDir));\
file.SaveAs(Server.MapPath(fileDir) + file.FileName);\
return Json(new { status = true, fpath = fileDir + file.FileName, fname
= file.FileName });\
}\
case \"CreateOrEditStorePic\":\
{\
List\<string\> imageType = new List\<string\>();

System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string maxImgName;\
string minImgName;\
System.Drawing.Image minImg;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
imageType.Add(\"image/gif\");\
imageType.Add(\"image/bmp\");\
if (!imageType.Contains(file.ContentType))\
{\
return Json(new { status = false, message =
\"只能上传:png,jpeg,gif,bmp格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/Customer/Store/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
maxImgName = guid.ToString() + \"\_max.jpg\";\
minImgName = guid.ToString() + \"\_min.jpg\";\
minImg = \_imagesHelper.MakeThumbnail(img, 200, 120);\
img.Save(mapPath + maxImgName, ImageFormat.Jpeg);\
minImg.Save(mapPath + minImgName, ImageFormat.Jpeg);\
img.Dispose();\
minImg.Dispose();\
return Json(new { status = true, maxUrl = imgDir + maxImgName, minUrl =
imgDir +\
minImgName });\
}\
case \"ExcelImpot\":\
{\
string Dir = \"/TempExcel/\";\
string Path = Server.MapPath(Dir);\
Directory.CreateDirectory(Path);\
string filepath = file.FileName;\
string filename = filepath.Substring(filepath.LastIndexOf(\"\\\\\") +
1);

filename = filename.Substring(filename.LastIndexOf(\".\"),
filename.Length -\
filename.LastIndexOf(\".\"));\
string guid = Guid.NewGuid() + filename;\
file.SaveAs(Path + guid);\
return Json(new { status = true, FilePath = Path + guid });\
}\
case \"createOrEditAdvertising\":\
{\
List\<string\> imageType = new List\<string\>();\
System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string ImgName;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
imageType.Add(\"image/gif\");\
imageType.Add(\"image/bmp\");\
if (!imageType.Contains(file.ContentType))\
{\
return Json(new { status = false, message =
\"只能上传:png,jpeg,gif,bmp格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/gg/\" + DateTime.Now.ToString(\"yyyy-MM-dd\") +
\"/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
ImgName = guid.ToString() + \".jpg\";\
img.Save(mapPath + ImgName, ImageFormat.Jpeg);\
img.Dispose();\
return Json(new { status = true, url = imgDir + ImgName });\
}\
case \"feedbackUpload\":\
{\
List\<string\> imageType = new List\<string\>();

System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string ImgName;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
imageType.Add(\"image/gif\");\
imageType.Add(\"image/bmp\");\
if (!imageType.Contains(file.ContentType))\
{\
return Json(new { status = false, message =
\"只能上传:png,jpeg,gif,bmp格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/feedback/\" +
DateTime.Now.ToString(\"yyyy-MM-dd\") + \"/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
ImgName = guid.ToString() + \".jpg\";\
img.Save(mapPath + ImgName, ImageFormat.Jpeg);\
img.Dispose();\
return Json(new { status = true, url = imgDir + ImgName });\
}\
case \"createOrEditArticleType\":\
{\
List\<string\> imageType = new List\<string\>();\
System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string ImgName;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
imageType.Add(\"image/gif\");\
imageType.Add(\"image/bmp\");\
if (!imageType.Contains(file.ContentType))\
{

return Json(new { status = false, message =
\"只能上传:png,jpeg,gif,bmp格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/ArticleType/\" +
DateTime.Now.ToString(\"yyyy-MM-dd\") + \"/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
ImgName = guid.ToString() + \".jpg\";\
System.Drawing.Image minImg = \_imagesHelper.MakeThumbnail(img, 100,
100);\
minImg.Save(mapPath + ImgName, ImageFormat.Jpeg);\
img.Dispose();\
minImg.Dispose();\
return Json(new { status = true, url = imgDir + ImgName });\
}\
case \"postUploadImg\":\
{\
List\<string\> imageType = new List\<string\>();\
System.Drawing.Image img;\
string imgDir;\
string mapPath;\
Guid guid;\
string ImgName;\
imageType.Add(\"image/png\");\
imageType.Add(\"image/jpeg\");\
imageType.Add(\"image/gif\");\
imageType.Add(\"image/bmp\");\
if (!imageType.Contains(file.ContentType))\
{\
return Json(new { status = false, message =
\"只能上传:png,jpeg,gif,bmp格式的图片\" });\
}\
img = System.Drawing.Image.FromStream(file.InputStream);\
imgDir = \"/LoadImage/post/\" + DateTime.Now.ToString(\"yyyy-MM-dd\") +
\"/\";\
mapPath = Server.MapPath(imgDir);\
Directory.CreateDirectory(mapPath);\
guid = Guid.NewGuid();\
ImgName = guid.ToString() + \".jpg\";\
img.Save(mapPath + ImgName, ImageFormat.Jpeg);

img.Dispose();\
return Json(new { status = true, url = imgDir + ImgName });\
}\
}\
return Json(\"UploadFile\");\
}
