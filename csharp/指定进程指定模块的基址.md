using System;\
using System.Collections.Generic;\
using System.Linq;\
using System.Text;\
using System.Runtime.InteropServices;\
namespace ConsoleApplication1\
{\
class Program\
{\
static void Main(string\[\] args)\
{\
Console.WriteLine(aaa.GetModuleBaseAddress(\"QQ.exe\", 0x1728));\
Console.ReadKey();\
}\
}\
class aaa {\
\[StructLayoutAttribute(LayoutKind.Sequential)\]\
public struct MODULEENTRY32\
{\
public uint dwSize;\
public uint th32ModuleID;\
public uint th32ProcessID;\
public uint GlblcntUsage;\
public uint ProccntUsage;\
public int modBaseAddr;\
public uint modBaseSize;\
public int hModule;\
\[MarshalAs(UnmanagedType.ByValTStr, SizeConst = 256)\]\
public string szModule;\
\[MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)\]\
public string szExePath;\
}\
\[DllImport(\"Kernel32.dll\")\]\
public static extern int CreateToolhelp32Snapshot(int dwFlags, int
th32ProcessID);

\[DllImport(\"Kernel32.dll\", EntryPoint = \"Module32First\")\]\
public static extern int Module32First(int Handle, ref MODULEENTRY32
Me);\
\[DllImport(\"kernel32.dll\")\]\
static extern bool Module32Next(int hSnapshot, ref MODULEENTRY32 lpme);\
\[DllImport(\"kernel32.dll\")\]\
public static extern void CloseHandle(int hObject);\
public static int GetModuleBaseAddress(string lpModulName, int
processId)\
{\
int snap;\
MODULEENTRY32 modul = new MODULEENTRY32();\
snap = CreateToolhelp32Snapshot(8, processId);\
modul.dwSize = 1024;\
Module32First(snap, ref modul);\
while (modul.szModule.ToString() != lpModulName)\
{\
Console.WriteLine(modul.szModule.ToString());\
if (!Module32Next(snap, ref modul))\
{\
continue;\
}\
}\
CloseHandle(snap);\
return modul.modBaseAddr;\
}\
}\
}
